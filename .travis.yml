language: cpp
script: cmake . && make && ctest --output-on-failure

before_script: 
   - sudo apt-get -qq update
   - sudo apt-get install -y libxml2-dev libboost-filesystem-dev libboost-test-dev libsqlite3-dev:amd64 sqlite sqlite3 libzmqpp-dev

# See https://scan.coverity.com/projects/ciscoruiz-coffee/builds/new?tab=travis_ci
env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "Z4ylcdiP4RBYqStUXOXD0MMQ1vHidkw63bRsQ1++XMejjoD6FdpxZywc2aVQ1AxoLKD/dEO/l/m9/GuFH8DojIrYkDr+k4Z84nC4rl9hsN2NsLp9xC1ShKgFEumf/pGJlVpjCEdTF6NEN0w8ejeJbS5EVlpPZz+4f2chgj1iR+IvaFx56OQApK/NtsTAIkHnrj2ZBwQ2/zKnTx3incXkGyf99irL/g3ErbkLWeiXXX280e/LnTGZ9fRHdyVCTb1T7KJc3PyXas8y0+g0EB7Adz24QHzDqSHlPjT/9+dIWFcNwMyLESQGA4QmfTtNQVTNq+dCX2YVtTofwisKzm5o85h237IpLiMNzbsThjx81SsiUnDNjh1OTe3/HFCurK9H6/2ToTp4UdddmEV6091D8QWXfJ3DnqC+HPCS0nxAPX2atkWZSfeppB+oB0j0+DtDb2m7z3zq/cm8TtoNa1/KjhG4EDTze4oyF/i0tbwuw1rfYrjajmqZhKLQy0nNSLvmcVQRo57U/HY2wJ/frJy/QiwvTd/f5R2Czm5c4xNI/4s1WppQseRCA7oi6Juxna2s0xTiIh4O+60AQV9vdXwJWeALWwy3PH8BjJbqhCSew9x+NXzXQwxWQMz1AafXFucAtseX9QL7irOsxglLRMRokGLiq9c6TC+p8kqWoQwDJ9U="

#
# Build Matrix
# 
matrix: 
    include:
   # Coverity Scan (Linux Debug)
    - os: linux
      compiler: gcc
      before_install:
        - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-5
            - cmake
            - libxml2-dev 
            - libboost-filesystem-dev 
            - libboost-test-dev 
            - libsqlite3-dev:amd64 
            - sqlite 
            - sqlite3 
            - libzmqpp-dev
        coverity_scan:
          project:
            name: "ciscoruiz/coffee"
            description: "A cross-platform C++14 project template"
          notification_email: cisco.tierra@gmail.com
          build_command_prepend: "cov-configure --comptype gcc --compiler g++-5 --template && cmake -DCMAKE_CXX_COMPILER=g++-5 ."
          build_command: "cmake --build ."
          branch_pattern: develop
          
    - os: linux
      env:
        - TEST="Codecov"
      script:
        - cmake -DCMAKE_BUILD_TYPE=COVERAGE 
        - make --jobs=4 && ctest --verbose
        - bash <(curl -s https://codecov.io/bash)

